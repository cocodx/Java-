#### 用户任务

![image](https://user-images.githubusercontent.com/97614802/231629170-78858ed6-451a-44c2-8662-a3f9cc271eb8.png)

##### 排它性

排它性作用：

而排他性（Exclusive）则是指在一个流程中，同一时间只能有一个用户执行该任务，即任务的执行是排他的。在Flowable中，可以通过指定User Task的排他性属性，来实现这种限制。

排他性对于流程的正确性和效率具有重要的作用。首先，如果一个User Task允许多个用户同时执行，可能会导致多个用户同时修改同一份数据，从而引发数据一致性问题；其次，如果一个User Task允许多个用户同时执行，可能会导致任务的执行效率降低，因为多个用户之间可能需要进行协调和通信。

因此，通过指定User Task的排他性属性，可以确保流程中同一时间只有一个用户执行该任务，从而保证数据的一致性和任务的执行效率。

##### 异步

异步作用：

异步 User Task 通常使用异步消息（Async Message）或异步信号（Async Signal）的方式来实现。具体来说，异步 User Task 的执行流程如下：

流程执行到 User Task 节点时，将任务信息发送到一个消息队列或者通过一个异步信号事件发布出去。

流程引擎继续执行后续的流程节点。

当用户完成任务后，通过消息队列或者异步信号事件，通知流程引擎。

流程引擎重新从消息队列或者异步信号事件中获取任务信息，继续执行 User Task 节点的后续任务。

异步 User Task 的使用可以提高流程执行的效率和灵活性，同时也可以降低流程的耦合性。例如，在一个复杂的流程中，可能需要等待多个用户完成任务后才能继续执行后续任务，使用异步 User Task 可以将这些任务并行化执行，缩短整个流程的执行时间。此外，异步 User Task 也可以与其他技术（如消息中间件和异步调用）结合使用，实现分布式系统中的异步协作。

##### 基数多实例

在Flowable的User Task中，基数多实例指的是将一个User Task实例化为多个子任务实例，这些子任务可以并行执行或串行执行。基数是指需要实例化的子任务数量。基数多实例的作用是提供了一种将一组任务分配给多个执行者并行执行的方式。

基数多实例通常用于以下情况：

并行处理：多个执行者可以同时处理相同的任务，从而加快处理速度。每个执行者可以独立处理任务，当所有任务都完成时，基数多实例任务也就完成了。

循环处理：在基数多实例中，可以设置循环次数，从而使任务在一定次数内重复执行。这种方式适用于需要对一组数据进行相同操作的情况，如批量审核、批量导出等。

动态任务分配：基数多实例可以根据一定的规则将任务分配给不同的执行者，从而实现动态任务分配。例如，可以根据执行者的工作负荷、能力等因素来决定任务分配。

总的来说，基数多实例为用户任务提供了更加灵活和高效的处理方式，使得任务可以更加精确地分配给执行者，提高了工作效率。

在Flowable的User Task中，可以通过设置基数（multiplicity）来创建基数多实例。基数可以是一个固定值，也可以是一个表达式，其值可以在运行时动态计算。

在BPMN 2.0中，基数可以使用以下语法进行设置：

固定值：使用标准的数字格式来指定基数，例如“3”表示要创建3个子任务实例。

表达式：使用${expression}语法来指定表达式，其中expression是一个可计算的表达式。例如，“${variableName}”表示使用变量variableName中的值来计算基数。

在Flowable Modeler中，可以通过以下步骤来设置基数：

在Modeler中打开User Task的属性窗口。

在“Multi Instance”部分中选择“Parallel”或“Sequential”选项。

Sequential: 一个节点里面，线性生成任务，一个任务完成接着一个任务生成

Parallel：同一时间生成，生成所有任务

在“Multi Instance”部分中输入基数值或表达式。

保存并部署流程定义。

在Java代码中，可以使用以下方式设置基数：

```java
// 创建基数多实例User Task
UserTask userTask = new UserTask();
// 设置基数
userTask.setLoopCardinality("${myVariable}");
// 设置多实例类型为并行处理
userTask.setLoopCharacteristics(new ParallelMultiInstanceLoopCharacteristics());

```
